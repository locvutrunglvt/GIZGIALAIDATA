<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>B√°o C√°o Kh·∫£o S√°t N√¥ng H·ªô</title>
    <style>
        @page { size: A4; margin: 1.5cm; }
        body { font-family: 'Times New Roman', serif; font-size: 11pt; line-height: 1.3; color: #000; }
        
        /* C·∫•u tr√∫c b·∫£ng */
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { border: 1px solid black; padding: 4px 6px; vertical-align: middle; }
        .no-border { border: none; }
        
        /* Header styles */
        .header-logos img { height: 60px; width: auto; }
        h1, h2, h3 { text-align: left; margin: 5px 0; text-transform: uppercase; }
        h1 { font-size: 14pt; font-weight: bold; color: #38761d; } /* M√†u xanh ti√™u ƒë·ªÅ */
        h2 { font-size: 13pt; font-weight: bold; }
        .report-title { font-size: 20pt; color: #b45f06; text-align: center; margin: 20px 0; font-weight: bold; }
        
        /* Section styles */
        .section-header { background-color: #eee; font-weight: bold; padding: 5px; margin-top: 20px; border: 1px solid #000; color: #783f04; }
        .sub-header { font-weight: bold; font-style: italic; margin-top: 10px; }
        
        /* Utility */
        .text-center { text-align: center; }
        .text-bold { font-weight: bold; }
        .bg-gray { background-color: #f0f0f0; }
        .loading { position: fixed; top:0; left:0; width:100%; height:100%; background:white; display:flex; justify-content:center; align-items:center; z-index:99; font-size:18px;}
        
        /* In ·∫•n */
        @media print { 
            .no-print { display: none; } 
            table { page-break-inside: auto; }
            tr { page-break-inside: avoid; page-break-after: auto; }
        }
    </style>
</head>
<body>

    <div id="loading" class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu b√°o c√°o...</div>
    <div class="no-print" style="text-align:center; padding:10px; background:#eee;">
        <button onclick="window.print()" style="padding:10px 20px; font-size:16px; cursor:pointer;">üñ®Ô∏è IN B√ÅO C√ÅO</button>
    </div>

    <table class="no-border">
        <tr class="no-border">
            <td class="no-border header-logos">
                <img src="https://via.placeholder.com/800x100?text=LOGO+PLACEHOLDER" alt="Logos">
            </td>
        </tr>
    </table>

    <h1>H·ªåC VI·ªÜN N√îNG NGHI·ªÜP VI·ªÜT NAM</h1>
    <h2>VI·ªÜN KINH T·∫æ V√Ä TH·ªÇ CH·∫æ N√îNG NGHI·ªÜP</h2>
    <div class="report-title">B·∫¢NG H·ªéI H·ªò N√îNG D√ÇN</div>

    <table>
        <tr>
            <td width="5%" class="text-center">1</td>
            <td width="25%">Ng√†y ph·ªèng v·∫•n</td>
            <td id="Interview_Date">...</td>
            <td width="20%" rowspan="6" class="text-center" style="vertical-align: middle;">
                <img id="Respondent_Image" src="" style="max-width:100%; max-height:150px; display:none;">
                <br><em>·∫¢nh ƒë·∫°i di·ªán</em>
            </td>
        </tr>
        <tr>
            <td class="text-center">2</td>
            <td>T·ªânh</td>
            <td>Gia Lai</td>
        </tr>
        <tr>
            <td class="text-center">4</td>
            <td>X√£</td>
            <td id="Commune">...</td>
        </tr>
        <tr>
            <td class="text-center">5</td>
            <td>Th√¥n</td>
            <td id="Village">...</td>
        </tr>
        <tr>
            <td class="text-center">6</td>
            <td>T√™n ch·ªß h·ªô</td>
            <td id="Owner_Name" class="text-bold">...</td>
        </tr>
        <tr>
            <td class="text-center">7</td>
            <td>S·ªë ƒëi·ªán tho·∫°i</td>
            <td id="Phone_Number">...</td>
        </tr>
        <tr>
            <td class="text-center">8</td>
            <td>Ng∆∞·ªùi tr·∫£ l·ªùi ph·ªèng v·∫•n</td>
            <td colspan="2" id="Respondent_Info">...</td>
        </tr>
        <tr>
            <td class="text-center">9</td>
            <td>Lo·∫°i h√¨nh kinh t·∫ø c·ªßa h·ªô</td>
            <td colspan="2" id="Economic_Class">...</td>
        </tr>
        <tr>
            <td class="text-center">10</td>
            <td>H·ªô c√≥ tham gia HTX kh√¥ng?</td>
            <td colspan="2" id="Coop_Member_YN">...</td>
        </tr>
        <tr>
            <td class="text-center">11</td>
            <td>S·ªë nƒÉm tr·ªìng c√† ph√™</td>
            <td colspan="2" id="Coffee_Years_Exp">...</td>
        </tr>
        <tr>
            <td class="text-center">12</td>
            <td>Chuy·ªÉn t·ª´ C√† ph√™ -> C√¢y kh√°c (5 nƒÉm)</td>
            <td colspan="2" id="Switch_Out_Coffee">...</td>
        </tr>
        <tr>
            <td class="text-center">13</td>
            <td>Chuy·ªÉn t·ª´ C√¢y kh√°c -> C√† ph√™ (5 nƒÉm)</td>
            <td colspan="2" id="Switch_In_Coffee">...</td>
        </tr>
    </table>

    <div class="section-header">A. TH√îNG TIN TH√ÄNH VI√äN H·ªò (HH MEMBERS)</div>
    <table id="table-members">
        <thead>
            <tr class="bg-gray text-center">
                <th>TT</th>
                <th>T√™n</th>
                <th>Gi·ªõi t√≠nh</th>
                <th>NƒÉm sinh</th>
                <th>D√¢n t·ªôc</th>
                <th>Quan h·ªá</th>
                <th>H·ªçc v·∫•n</th>
                <th>Tham gia SX?</th>
                <th>C√¥ng ƒëo·∫°n</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div class="section-header">B. THU NH·∫¨P GIA ƒê√åNH (FAMILY INCOMES)</div>
    <table>
        <tr class="bg-gray text-center">
            <th width="5%">TT</th>
            <th colspan="2">N·ªôi dung</th>
            <th>ƒê∆°n v·ªã</th>
            <th>NƒÉm 2025</th>
        </tr>
        <tr>
            <td class="text-center">1</td>
            <td colspan="2">a. T·ªïng thu nh·∫≠p r√≤ng</td>
            <td class="text-center">Tri·ªáu ƒë·ªìng</td>
            <td id="Total_Net_Income">...</td>
        </tr>
        <tr>
            <td></td>
            <td colspan="2">b. T·ª∑ tr·ªçng thu nh·∫≠p n√¥ng nghi·ªáp</td>
            <td class="text-center">%</td>
            <td id="Agri_Income_Pct">...</td>
        </tr>
        <tr>
            <td class="text-center">2</td>
            <td colspan="2" class="text-bold">Thu nh·∫≠p t·ª´ n√¥ng nghi·ªáp</td>
            <td class="text-center">Tri·ªáu ƒë·ªìng</td>
            <td id="Agri_Net_Income">...</td>
        </tr>
        <tr>
            <td></td>
            <td width="5%">a</td>
            <td>Thu t·ª´ tr·ªìng tr·ªçt</td>
            <td></td>
            <td id="Crop_Income">...</td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td>1. C√† ph√™</td>
            <td class="text-center">Tri·ªáu ƒë·ªìng</td>
            <td id="Coffee_Income">...</td> </tr>
        <tr>
            <td></td>
            <td></td>
            <td>2. Tr·ªìng l√∫a</td>
            <td></td>
            <td id="Rice_Income">...</td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td>3. C√¢y ƒÉn tr√°i</td>
            <td></td>
            <td id="Fruit_Income">...</td>
        </tr>
         <tr>
            <td></td>
            <td class="text-center">b</td>
            <td>Thu t·ª´ th·ªßy s·∫£n</td>
            <td></td>
            <td id="Aqua_Income">...</td>
        </tr>
         <tr>
            <td></td>
            <td class="text-center">c</td>
            <td>Thu t·ª´ chƒÉn nu√¥i kh√°c</td>
            <td></td>
            <td id="Livestock_Income">...</td>
        </tr>
        <tr>
            <td class="text-center">3</td>
            <td colspan="2">Lao ƒë·ªông th∆∞·ªùng xuy√™n</td>
            <td></td>
            <td id="Salaried_Income">...</td>
        </tr>
        <tr>
            <td class="text-center">4</td>
            <td colspan="2">Lao ƒë·ªông th·ªùi v·ª•</td>
            <td></td>
            <td id="Seasonal_Income">...</td>
        </tr>
        <tr>
            <td class="text-center">5</td>
            <td colspan="2">T·ª± kinh doanh</td>
            <td></td>
            <td id="Business_Income">...</td>
        </tr>
        <tr>
            <td class="text-center">6</td>
            <td colspan="2">Kh√°c</td>
            <td></td>
            <td id="Other_Income">...</td>
        </tr>
    </table>

    <div class="section-header">C. ƒê·∫§T ƒêAI & CANH T√ÅC (LAND TENURE)</div>
    <table>
        <tr>
            <td width="5%" class="text-center">1</td>
            <td>T·ªïng di·ªán t√≠ch s·∫£n xu·∫•t c√† ph√™ (ha)</td>
            <td id="Total_Coffee_Area">...</td>
        </tr>
        <tr>
            <td class="text-center">2</td>
            <td>S·ªë m·∫£nh tr·ªìng c√† ph√™</td>
            <td id="Plot_Quantity">...</td>
        </tr>
    </table>
    
    <div class="sub-header">Th√¥ng tin chi ti·∫øt c√°c m·∫£nh ƒë·∫•t (Land Plots)</div>
    <table id="table-plots" style="font-size: 10pt;">
        <thead>
            <tr class="bg-gray text-center">
                <th>M·∫£nh</th>
                <th>DT (ha)</th>
                <th>DT R·ª´ng</th>
                <th>S·ªë c√¢y</th>
                <th>Xen canh</th>
                <th>C√¢y xen</th>
                <th>S·ªü h·ªØu</th>
                <th>NƒÉm tr·ªìng</th>
                <th>B·∫£n ƒë·ªì GPS</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div class="section-header">D. T√ÄI CH√çNH N√îNG NGHI·ªÜP</div>
    <table>
        <tr>
            <td width="5%">1</td>
            <td>Ngu·ªìn vay v·ªën th∆∞·ªùng xuy√™n</td>
            <td id="Loan_Source">...</td>
        </tr>
        <tr>
            <td>2</td>
            <td>ƒê√°nh gi√° ƒëi·ªÅu ki·ªán vay</td>
            <td id="Loan_Rating">...</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Bi·∫øt c√°c ch∆∞∆°ng tr√¨nh h·ªó tr·ª£?</td>
            <td id="Support_Prog_Aware">...</td>
        </tr>
        <tr>
            <td>8</td>
            <td>Nhu c·∫ßu vay v·ªën EUDR?</td>
            <td id="Loan_need_EUDR">...</td>
        </tr>
    </table>

    <div class="section-header">G. TRUY XU·∫§T NGU·ªíN G·ªêC (TRACEABILITY)</div>
    <table>
        <tr>
            <td width="5%">1</td>
            <td>Nghe n√≥i ƒë·∫øn TXNG?</td>
            <td id="Trace_Aware_YN">...</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Y√™u c·∫ßu c·ªßa b√™n mua:</td>
            <td id="Buyer_Requirements">...</td>
        </tr>
        <tr>
            <td>3</td>
            <td>ƒê√£ √°p d·ª•ng ch∆∞a?</td>
            <td id="Trace_Applied_YN">...</td>
        </tr>
        <tr>
            <td>4</td>
            <td>M√¥ t·∫£ h·ªá th·ªëng:</td>
            <td id="Trace_System_Desc">...</td>
        </tr>
         <tr>
            <td>6</td>
            <td>ƒê·ªô d·ªÖ √°p d·ª•ng:</td>
            <td id="Trace_Ease_Score">...</td>
        </tr>
        <tr>
            <td>7</td>
            <td>R√†o c·∫£n/Kh√≥ khƒÉn:</td>
            <td id="Trace_Barriers">...</td>
        </tr>
    </table>

    <div class="section-header">H. CANH T√ÅC B·ªÄN V·ªÆNG</div>
    <table id="table-sustainable">
        <thead>
            <tr class="bg-gray text-center">
                <th>TT</th>
                <th>Ph∆∞∆°ng th·ª©c/Ch·ª©ng ch·ªâ</th>
                <th>Bi·∫øt kh√¥ng?</th>
                <th>Ai bi·∫øt?</th>
                <th>H·ªØu √≠ch?</th>
                <th>Th·ª±c h√†nh?</th>
                <th>ƒê∆∞·ª£c ch·ª©ng nh·∫≠n?</th>
                <th>Ai th·ª±c h√†nh?</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <div class="section-header">J. ƒê√ÅNH GI√Å & NHU C·∫¶U H·ªñ TR·ª¢</div>
    <table>
        <tr>
            <td width="5%">1</td>
            <td>Kh√≥ khƒÉn l·ªõn nh·∫•t (EUDR)</td>
            <td id="EUDR_Max_Difficulty">...</td>
        </tr>
        <tr>
            <td>2</td>
            <td colspan="2" class="text-bold">Mong mu·ªën h·ªó tr·ª£ t·ª´ d·ª± √°n SAFE:</td>
        </tr>
        <tr>
            <td></td>
            <td>Ph√°p l√Ω ƒë·∫•t ƒëai</td>
            <td id="Land_Legal">...</td>
        </tr>
        <tr>
            <td></td>
            <td>Truy xu·∫•t ngu·ªìn g·ªëc</td>
            <td id="Traceability_need">...</td>
        </tr>
        <tr>
            <td></td>
            <td>K·ªπ thu·∫≠t canh t√°c</td>
            <td id="Farm_Tech">...</td>
        </tr>
        <tr>
            <td></td>
            <td>K·∫øt n·ªëi doanh nghi·ªáp</td>
            <td id="Biz_Connect">...</td>
        </tr>
         <tr>
            <td></td>
            <td>Kh√°c (Ghi r√µ)</td>
            <td id="Other_SAFE_Support_Wish">...</td>
        </tr>
    </table>

    <script>
        // --- C·∫§U H√åNH ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwFchEzhV3NQ23F_cnUwSt3M0ZodDNCopx8EyZE2Tbe2HZTLqaKvjTbZtMhnvplKsBE/exec"; 

        async function loadData() {
            const params = new URLSearchParams(window.location.search);
            const id = params.get('id');
            if (!id) { alert("Thi·∫øu ID!"); return; }

            try {
                const res = await fetch(SCRIPT_URL + "?id=" + id);
                const data = await res.json();
                
                if (data.error) { alert("L·ªói: " + data.error); return; }

                // 1. ƒêI·ªÄN D·ªÆ LI·ªÜU ƒê∆†N (T·ª± ƒë·ªông t√¨m ID tr√πng t√™n c·ªôt)
                for (const key in data) {
                    const el = document.getElementById(key);
                    if (el) el.innerText = data[key];
                }

                // X·ª≠ l√Ω ri√™ng: Gi·ªõi t√≠nh + Ng∆∞·ªùi tr·∫£ l·ªùi (VD: √îng A, 1990)
                if (data.Respondent_Name) {
                    const prefix = data.Gender == 'Nam' ? '√îng' : 'B√†'; // L∆∞u √Ω: 'Nam' ph·∫£i kh·ªõp data raw
                    document.getElementById('Respondent_Info').innerText = `${prefix} ${data.Respondent_Name}, ${data['Year of birth'] || ''}`;
                }

                // X·ª≠ l√Ω ·∫¢nh
                if (data.Images) {
                    // X·ª≠ l√Ω link ·∫£nh n·∫øu c·∫ßn (ph·ª• thu·ªôc AppSheet l∆∞u ·∫£nh th·∫ø n√†o)
                    // document.getElementById('Respondent_Image').src = ... 
                    // document.getElementById('Respondent_Image').style.display = 'block';
                }

                // 2. ƒêI·ªÄN B·∫¢NG CON: HH MEMBERS
                renderTable('table-members', data.HH_MEMBERS, [
                    'TT', 'Member_name', 'Gender', 'Year of birth', 'Ethlic', 'Relatives', 'Study level', 'Pember participate in coffee production', 'Which stage of production'
                ]);

                // 3. ƒêI·ªÄN B·∫¢NG CON: LAND PLOTS
                renderTable('table-plots', data.LAND_PLOTS, [
                    'TT', 'Area_Ha', 'Forest area per plot', 'Tree_Count', 'Intercropping_YN', 'Tree_Intercropping', 'Ownership_Type', 'Start_Year', 'GPS_Mapped_YN'
                ]);

                // 4. ƒêI·ªÄN B·∫¢NG CON: SUSTAINABLE
                renderTable('table-sustainable', data.SUSTAINABLE, [
                    'TT', 'Certificate', 'Is_Known', 'Who_Knows_Most', 'Is_Beneficial', 'Is_Practiced', 'Is_Certified', 'Who_Practices'
                ]);

                document.getElementById('loading').style.display = 'none';

            } catch (e) {
                console.error(e);
                alert("L·ªói k·∫øt n·ªëi: " + e.message);
            }
        }

        // H√†m h·ªó tr·ª£ v·∫Ω b·∫£ng con
        function renderTable(tableId, rowData, columns) {
            const tbody = document.querySelector(`#${tableId} tbody`);
            tbody.innerHTML = "";
            if (!rowData || rowData.length === 0) {
                tbody.innerHTML = `<tr><td colspan="${columns.length}" class="text-center">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>`;
                return;
            }
            rowData.forEach(row => {
                let tr = "<tr>";
                columns.forEach(col => {
                    tr += `<td>${row[col] || ''}</td>`;
                });
                tr += "</tr>";
                tbody.innerHTML += tr;
            });
        }

        loadData();
    </script>

</body>
</html>
