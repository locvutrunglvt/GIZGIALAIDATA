<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>B√°o c√°o N√¥ng h·ªô</title>
    <style>
        /* CSS IN ·∫§N C∆† B·∫¢N */
        @page { size: A4; margin: 1.5cm; }
        body { font-family: 'Times New Roman', serif; font-size: 13px; line-height: 1.3; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        th, td { border: 1px solid black; padding: 5px; vertical-align: middle; }
        .header { text-align: center; font-weight: bold; margin-bottom: 20px; }
        .section-title { font-weight: bold; background-color: #eee; padding: 5px; margin-top: 15px; border: 1px solid #000; }
        .text-center { text-align: center; }
        .loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; display: flex; justify-content: center; align-items: center; font-size: 20px; z-index: 9999; }
        img { max-width: 100%; height: auto; }
        /* ·∫®n n√∫t in khi in ra gi·∫•y */
        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

    <div id="loading" class="loading">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ AppSheet...</div>

    <div class="header">
        <img src="https://i.imgur.com/example-logo.jpg" style="height: 60px;"> <br><br>
        H·ªåC VI·ªÜN N√îNG NGHI·ªÜP VI·ªÜT NAM<br>
        VI·ªÜN KINH T·∫æ V√Ä TH·ªÇ CH·∫æ N√îNG NGHI·ªÜP<br>
        <span style="font-size: 18px; color: #b45f06;">B·∫¢NG H·ªéI H·ªò N√îNG D√ÇN</span>
    </div>

    <table>
        <tr>
            <td width="5%">1</td>
            <td width="20%">Ng√†y ph·ªèng v·∫•n</td>
            <td id="Interview_Date">...</td>
            <td width="20%" class="text-center" rowspan="5">
                <img id="Respondent_Image" src="" style="max-height: 120px; display:none;">
            </td>
        </tr>
        <tr>
            <td>2</td>
            <td>T·ªânh</td>
            <td>Gia Lai</td>
        </tr>
        <tr>
            <td>4</td>
            <td>X√£</td>
            <td id="Commune">...</td> </tr>
        <tr>
            <td>5</td>
            <td>Th√¥n</td>
            <td id="Village">...</td>
        </tr>
        <tr>
            <td>6</td>
            <td>T√™n ch·ªß h·ªô</td>
            <td id="Owner_Name" style="font-weight:bold;">...</td>
        </tr>
        <tr>
            <td>7</td>
            <td>S·ªë ƒëi·ªán tho·∫°i</td>
            <td id="Phone_Number">...</td>
        </tr>
    </table>

    <div class="section-title">A. TH√îNG TIN TH√ÄNH VI√äN & THU NH·∫¨P</div>
    
    <table>
        <tr>
            <td width="5%">1</td>
            <td>T·ªïng thu nh·∫≠p (tri·ªáu ƒë·ªìng)</td>
            <td id="Total_Net_Income">...</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Thu nh·∫≠p t·ª´ c√† ph√™</td>
            <td id="Coffee_Income">...</td> </tr>
    </table>

    <div class="section-title">B. TH√îNG TIN ƒê·∫§T ƒêAI (LAND PLOTS)</div>
    <table id="table-plots">
        <thead>
            <tr style="background: #f0f0f0; font-weight: bold; text-align: center;">
                <td>M·∫£nh</td>
                <td>Di·ªán t√≠ch (ha)</td>
                <td>S·ªë c√¢y</td>
                <td>NƒÉm tr·ªìng</td>
                <td>S·∫£n l∆∞·ª£ng 2025</td>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <div class="no-print" style="text-align: center; margin-top: 30px;">
        <button onclick="window.print()" style="padding: 10px 20px; font-size: 16px; cursor: pointer;">üñ®Ô∏è IN B√ÅO C√ÅO</button>
    </div>

    <script>
        // --- C·∫§U H√åNH ---
        // D√°n URL Web App b·∫°n copy ·ªü B∆∞·ªõc 1 v√†o ƒë√¢y:
        const SCRIPT_URL ="https://script.google.com/macros/s/AKfycbwFchEzhV3NQ23F_cnUwSt3M0ZodDNCopx8EyZE2Tbe2HZTLqaKvjTbZtMhnvplKsBE/exec"; 

        async function loadData() {
            // 1. L·∫•y ID t·ª´ thanh ƒë·ªãa ch·ªâ (?id=...)
            const params = new URLSearchParams(window.location.search);
            const farmerID = params.get('id');

            if (!farmerID) {
                alert("Kh√¥ng t√¨m th·∫•y ID n√¥ng d√¢n!");
                document.getElementById('loading').innerText = "L·ªói: Thi·∫øu ID";
                return;
            }

            try {
                // 2. G·ªçi Google Apps Script ƒë·ªÉ l·∫•y d·ªØ li·ªáu
                const response = await fetch(SCRIPT_URL + "?id=" + farmerID);
                const data = await response.json();

                if (!data || data.error) {
                    alert("Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu!");
                    return;
                }

                // 3. ƒêI·ªÄN D·ªÆ LI·ªÜU V√ÄO C√ÅC √î ƒê∆†N (Th√¥ng tin chung)
                // H√†m n√†y s·∫Ω t√¨m c√°c th·∫ª c√≥ id="T√™nC·ªôt" v√† ƒëi·ªÅn d·ªØ li·ªáu v√†o
                for (const key in data) {
                    const el = document.getElementById(key);
                    if (el) {
                        el.innerText = data[key]; // ƒêi·ªÅn text
                    }
                }

                // X·ª≠ l√Ω ri√™ng cho ·∫¢nh (n·∫øu c√≥ c·ªôt Images ch·ª©a link ·∫£nh)
                if (data.Images) {
                    const img = document.getElementById('Respondent_Image');
                    // AppSheet l∆∞u ·∫£nh d·∫°ng "Folder/File.jpg", c·∫ßn x·ª≠ l√Ω ƒë·ªÉ hi·ªÉn th·ªã n·∫øu c·∫ßn
                    // ·ªû ƒë√¢y gi·∫£ ƒë·ªãnh b·∫°n c√≥ link ·∫£nh public ho·∫∑c base64
                    // img.src = data.Images; 
                    // img.style.display = 'block';
                }

                // 4. ƒêI·ªÄN D·ªÆ LI·ªÜU B·∫¢NG CON (LAND PLOTS)
                const plots = data.LAND_PLOTS; // T√™n key ph·∫£i kh·ªõp trong Apps Script
                const tableBody = document.querySelector("#table-plots tbody");
                
                if (plots && plots.length > 0) {
                    plots.forEach(plot => {
                        const row = `
                            <tr>
                                <td class="text-center">${plot.TT || ''}</td>
                                <td class="text-center">${plot.Area_Ha || ''}</td>
                                <td class="text-center">${plot.Tree_Count || ''}</td>
                                <td class="text-center">${plot.Start_Year || ''}</td>
                                <td class="text-center">${plot.Yield_2025 || ''}</td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                } else {
                    tableBody.innerHTML = "<tr><td colspan='5' class="text-center">Kh√¥ng c√≥ d·ªØ li·ªáu m·∫£nh v∆∞·ªùn</td></tr>";
                }

                // T·∫Øt m√†n h√¨nh ch·ªù
                document.getElementById('loading').style.display = 'none';

                // T·ª± ƒë·ªông b·∫≠t c·ª≠a s·ªï in (t√πy ch·ªçn)
                // setTimeout(() => window.print(), 1000);

            } catch (error) {
                console.error(error);
                document.getElementById('loading').innerText = "L·ªói k·∫øt n·ªëi server!";
            }
        }

        // Ch·∫°y h√†m khi m·ªü trang
        loadData();
    </script>

</body>
</html>